<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>رفع صورة مشفّرة — التخزين السحابي الآمن</title>
  
  <!-- خطوط -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="assets/style.css" />
  <!-- CSP معدّل للسماح بتحميل الخطوط من جوجل (مكمّل) -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; connect-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com;">
</head>

<body class="bg">
  <main class="container" role="main" aria-labelledby="pageTitle">
    <header class="brand">
      <div class="brand-left">
        <!-- logo symbol flat -->
        <svg width="44" height="44" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <rect width="24" height="24" rx="6" fill="#111"></rect>
          <path d="M6 8h12v1H6zM6 11h12v1H6zM6 14h12v1H6z" fill="#c62828" opacity="0.95" />
        </svg>
      </div>
      
      <div class="brand-info">
        <h1 id="pageTitle">التخزين السحابي المُظلم</h1>
        <p class="subtitle">رفع صورة مشفّرة — أنت تختار كلمة المرور</p>
      </div>
    </header>
    
    <section class="card">
      <div class="card-grid">
        <aside class="card-aside">
          <h2 class="aside-title">رفع صورة جديدة</h2>
          <p class="aside-desc">الصور تُشفّر محليًا على جهاز المستخدم قبل الإرسال. لا نخزن اسم الملف الأصلي على الخادم — فقط الـ token الذي تحصل عليه بعد الرفع.</p>
          
          <ul class="features">
            <li>✦ تشفير على الجهاز</li>
            <li>✦ استرجاع عبر Token + كلمة المرور</li>
            <li>✦ تصميم بسيط وآمن</li>
          </ul>
        </aside>
        
        <div class="card-body">
          <form id="uploadForm" class="form" autocomplete="off" novalidate>
            <label class="field">
              <span class="field-label">اسم عرضي (اختياري)</span>
              <input id="displayName" type="text" maxlength="190" placeholder="مثال: صورة_العطلة" />
            </label>
            
            <label class="field">
              <span class="field-label">اختر ملف الصورة</span>
                <input id="file" type="file" accept="image/*" required />
            </label>
            
            <label class="field">
              <span class="field-label">كلمة المرور (للتشفير)</span>
              <div class="input-icon">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M17 8v-2a5 5 0 0 0-10 0v2" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"></path>
                  <rect x="4" y="10" width="16" height="10" rx="2" stroke="currentColor" stroke-width="1.6" fill="none" />
                </svg>
                <input id="password" type="password" minlength="8" placeholder="كلمة مرور قوية (نوصي 12+ حرف)" required />
              </div>
            </label>
            
            <div class="row">
              <button id="btnUpload" type="submit" class="btn primary" aria-live="polite">ارفع الآن</button>
              <button id="btnReset" type="button" class="btn ghost">مسح الحقول</button>
            </div>
            
            <div id="status" class="status" role="status" aria-atomic="true"></div>
            
            <div id="tokenBox" class="status token-box hidden" aria-hidden="true">
              <strong>Token (احفظه):</strong>
              <div id="tokenVal" class="token-val" style="word-break:break-all"></div>
              <div class="hint">هذا الـ token هو المفتاح لاسترجاع الصورة. احفظه في مكان آمن. لن نعرض اسم الملف الأصلي على الخادم.</div>
            </div>
          </form>
        </div>
      </div>
    </section>
    
    <footer class="foot">
      <a href="fetch.html" class="link">اذهب لصفحة الجلب</a>
    </footer>
  </main>
  
  <script src="assets/upload.js"></script>
  <script>
    // UX: عرض اسم الملف داخل الـ wrapper (عرضي — لا يغيّر من وظائفك)
    (function() {
      const file = document.getElementById('file');
      const fileName = document.getElementById('fileName');
      const fileBtn = document.querySelector('.file-btn');
      if (!file) return;
      file.addEventListener('change', () => {
        if (file.files && file.files.length) fileName.textContent = file.files[0].name;
        else fileName.textContent = 'لم يتم اختيار ملف';
      });
      if (fileBtn) fileBtn.addEventListener('click', () => file.click());
    })();
  </script>
</body>

</html>